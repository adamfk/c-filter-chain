<!doctype html>
<html>
  <script src="fc_lib.js"></script>
  <script>
    //try making it a bit more clear for users. "Module" is a rather unhelpful term, but is the object created by Emscripten to allow JavaSript to interact with the compiled C/C++ code.
    window.CodeBridge = Module; 
  </script>
  
  
  <script>
    window.output = 0;
    let iir = new Module.IirLowPass();
    iir.last_output = 77;
    iir.new_ratio = 0.12345;
    Module.IirLowPass_ctor(iir);
    Module.EmIirLowPass_preload(iir, 100);
    iir.new_ratio = 0.5;
    
    for(let i=0; i < 5; i++) {
        window.output = Module.EmIirLowPass_step(iir, 0);
        console.log(window.output);
    }
    
    console.log(iir);
    
    let mbc = Module.makeMallocatorBuildContext();
    let iirNew = Module.IirLowPass_new(mbc, 0.234);
    
    if (mbc.one_or_more_failures) {throw "allocation failure!"; }
    
    Module.EmIirLowPass_preload(iirNew, 100);
    iirNew.new_ratio = 0.5;
    
    for(let i=0; i < 5; i++) {
        window.output = Module.EmIirLowPass_step(iirNew, 0);
        console.log(window.output);
    }
    
  </script>  

  <body>
  This is an experiment.
  </body>

</html>
